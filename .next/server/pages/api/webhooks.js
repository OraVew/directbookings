"use strict";(()=>{var e={};e.id=857,e.ids=[857],e.modules={5142:e=>{e.exports=require("dotenv")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},6840:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.r(t),o.d(t,{config:()=>l,default:()=>d,routeModule:()=>u});var r=o(1802),a=o(7153),s=o(6249),c=o(7685),i=e([c]);c=(i.then?(await i)():i)[0];let d=(0,s.l)(c,"default"),l=(0,s.l)(c,"config"),u=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/webhooks",pathname:"/api/webhooks",bundlePath:"",filename:""},userland:c});n()}catch(e){n(e)}})},7685:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.r(t),o.d(t,{config:()=>i,default:()=>u});var r=o(6090);(function(){var e=Error("Cannot find module 'micro'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module 'micro-cors'");throw e.code="MODULE_NOT_FOUND",e}();var a=e([r]);r=(a.then?(await a)():a)[0],o(5142).config();let s=new r.default(process.env.STRIPE_SECRET_KEY),c=process.env.STRIPE_WEBHOOK_SECRET,i={api:{bodyParser:!1}},d=Object(function(){var e=Error("Cannot find module 'micro-cors'");throw e.code="MODULE_NOT_FOUND",e}())({allowMethods:["POST","HEAD"]}),l=async(e,t)=>{if("POST"===e.method){let o;let n=await Object(function(){var e=Error("Cannot find module 'micro'");throw e.code="MODULE_NOT_FOUND",e}())(e),r=e.headers["stripe-signature"];try{o=s.webhooks.constructEvent(n.toString(),r,c)}catch(e){console.log(`❌ Error message: ${e.message}`),t.status(400).send(`Webhook Error: ${e.message}`);return}switch(console.log("✅ Success:",o.id),o.type){case"payment_intent.succeeded":{let e=o.data.object;console.log(`PaymentIntent status: ${e.status}`);break}case"payment_intent.payment_failed":{let e=o.data.object;console.log(`❌ Payment failed: ${e.last_payment_error?.message}`);break}case"charge.succeeded":{let e=o.data.object;console.log(`Charge id: ${e.id}`);break}default:console.warn(`Unhandled event type: ${o.type}`)}t.json({received:!0})}else t.setHeader("Allow","POST"),t.status(405).end("Method Not Allowed")},u=d(l);n()}catch(e){n(e)}})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=6840);module.exports=o})();